<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="/Mods/Upvoid/Web.Tools.Common/1.0.0/css/bootstrap.min.css">
    <title>Loading</title>
</head>
<body style="background: transparent;">
    <div class="panel panel-default" style="width: 75%; margin: 100px auto;">
        <div class="panel-body text-center">
            <h1>Generating World</h1>
            <div id="world-generation-progress" class="progress progress-striped active">
                <div id="world-generation-progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
            </div>

            <h2 id="loading-notice">This may take several minutes, depending on your CPU speed.</h2>
            <a id="start-button" href="javascript: clickStart()" class="btn btn-block btn-lg btn-success hidden">Start</a>
            <a class="text-right" href="javascript: clickStart()">I'm impatient, start right now</a>
        </div>
    </div>

    <script src="/Mods/Upvoid/Web.Tools.Common/1.0.0/js/jquery-2.0.3.min.js"></script>
    <script src="/Mods/Upvoid/Web.Tools.Common/1.0.0/js/bootstrap.min.js"></script>
    <script src="/Mods/Upvoid/Web.Tools.Plots/1.0.0/plots/plots.js"></script>
    <script>

        // Query the current generation progress
        $.get("/Mods/Upvoid/UpvoidMiner/0.0.1/GenerationProgressQuery", "", function(data) {
            $('#world-generation-progress-bar').css('width', (data*data*100.0)+"%");
            if(data >= 1.0)
            {
                $('#world-generation-progress').removeClass('active');
                $('#world-generation-progress').removeClass('progress-striped');
                $('#loading-notice').hide();
                $('#start-button').removeClass("hidden");
            }
        });

        // Register the websocket handler for future progress updates
        WebsocketHandler.register("/Mods/Upvoid/UpvoidMiner/0.0.1/GenerationProgressSocket", function(data) {
            $('#world-generation-progress-bar').css('width', (data*data*100.0)+"%");
            if(data >= 1.0)
            {
                $('#world-generation-progress').removeClass('active');
                $('#world-generation-progress').removeClass('progress-striped');
                $('#loading-notice').hide();
                $('#start-button').removeClass("hidden");
            }
        });

        function clickStart()
        {
            $.get("/Mods/Upvoid/UpvoidMiner/0.0.1/ActivatePlayer", "", function() {window.location.href = "IngameGui.html";});
        }

    </script>

</body>
</html>